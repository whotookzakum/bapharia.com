main {
    display: grid;
    min-height: calc(100vh - var(--nav-height) - 345px);
    min-height: calc(100dvh - var(--nav-height) - 345px);
}

.fullpage {
    min-height: 100dvh;
    margin-top: calc(var(--nav-height) * -1);
    place-content: center;
}

.panes {
    --gutter-y: 5rem;
    --gutter-x: 2rem;
    --sidepane-width: 220px;
    --text-length: 60ch;
    --pane-column-gap: clamp(1rem, 2.8vw, 3rem);
    width: 100%;
    max-width: calc(var(--max-content-width) + var(--gutter-x) * 2);
    display: grid;
    grid-template-columns: var(--sidepane-width) auto;
    padding: var(--gutter-y) var(--gutter-x);
    margin-inline: auto;
    column-gap: var(--pane-column-gap);
}

.side-pane,
.toc {
    position: sticky;
    top: calc(var(--nav-height) + 5rem);
    font-size: var(--step-1);
    letter-spacing: 0.02em;
    align-self: start;

    *:not(.mini-header):not(:hover) {
        color: var(--text2);
    }

    ul::before {
        @extend .mini-header;
        // content: attr(data-pane-title); // or aria-label
    }

    ol::before {
        @extend .mini-header;
        content: "Contents";
    }

    details[open] {
        color: var(--text1);
    }

    details[open] summary {
        // font-weight: inherit;
        color: inherit !important;
    }

    details[open] summary::after {
        border-color: inherit;
    }

    summary:not(:where(:hover, :focus-visible))::after {
        content: unset;
    }

    nav > a {
        width: fit-content;
    }
}

.toc {
    grid-column: 2;
    grid-row: 1/-1;
}

// .side-pane {
//     overflow: clip;
//     max-height: calc(100vh - var(--nav-height) - var(--gutter-y) * 2 - 33px);
// }

.main-pane {
    display: grid;
    grid-template-columns: 1fr var(--sidepane-width);
    grid-template-rows: auto auto;
    column-gap: var(--pane-column-gap) !important;
    align-content: start;

    &>*:not(.toc) {
        grid-column: 1;
    }

    hgroup {
        margin-bottom: 2rem;
        display: grid;
    }

    hgroup .mini-header {
        order: 1;
        color: var(--accent2);
        line-height: unset;
        margin-bottom: 2px;
    }

    // TODO: Should I re-order the markup so h1 comes before p.mini-header?

    hgroup>*:not(.mini-header) {
        order: 2;
    }

    p:not(.mini-header, .attribution) {
        line-height: 1.75;
        font-size: var(--step-2);
        letter-spacing: 0.02em;
        max-inline-size: var(--text-length);
        text-wrap: pretty;
    }

    img,
    video,
    iframe {
        max-width: 100%;
    }

    section>img,
    figure img,
    section>video,
    figure video {
        margin-top: 1rem;
        border-radius: 1rem;
    }

    table {
        width: 100%;
    }
}

@media (max-width: 1150px) {
    .main-pane {
        grid-template-columns: 1fr;

        * {
            order: 3;
        }

        hgroup {
            order: 1;
        }
    }

    .side-pane,
    .toc {
        align-self: unset;
    }

    .toc {
        grid-column: 1;
        grid-row: unset;
        order: 2;
        position: unset;
        margin-block: 1rem;

        ol {
            gap: 0;
            margin-top: -1rem;
        }

        ol::before {
            margin-bottom: 0.5rem;
        }

        li {
            display: flex;
        }

        a {
            padding-left: 1rem;
            margin-left: 0.5rem;
            line-height: 1.75;
            border-left: 1px solid var(--surface1);
        }
    }
}

@media (max-width: 850px) {
    .panes {
        grid-template-columns: 1fr;
        --gutter-x: 1rem;
    }

    .main-pane,
    .side-pane,
    .toc {
        p:not(.mini-header, .attribution),
        li a {
            font-size: var(--step-0) !important;
        }
    }

    // Shrink element icons on classes
    hgroup img {
        width: 30px;
        height: auto;
    }

    .side-pane {
        position: unset;
        margin-bottom: var(--gutter-x);

        nav>a::before {
            content: "← Back to ";
        }

        nav ul {
            display: none;
        }
    }
}


.ambience {
    // Blob style
    background: radial-gradient(140% 173% at 70% 65%,
            rgba(20, 161, 255, 0.055),
            transparent 30%),
        radial-gradient(100% 140% at 30% 45%,
            rgba(255, 20, 145, 0.035),
            transparent 30%),
        radial-gradient(180% 140% at 52.3% 31%,
            rgba(0, 162, 255, 0.033),
            transparent 30%),
        radial-gradient(180% 140% at 52.3% 31%,
            rgba(20, 255, 118, 0.035),
            transparent 30%);

    // Ambient spotlight
    background: radial-gradient(140% 173% at 70% 65%,
            hsla(308, 57%, 19%, 0.5),
            transparent 30%),
        radial-gradient(100% 140% at 30% 45%,
            hsla(269, 45%, 23%, 0.5),
            transparent 30%),
        radial-gradient(180% 140% at 100% 100%,
            hsla(248, 46%, 27%, 0.5),
            transparent 30%),
        radial-gradient(180% 140% at 0% 0%,
            hsla(227, 61%, 26%, 0.5),
            transparent 30%);

    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    z-index: -1;
    animation: 2.4s ease 1 forwards fadein;
}